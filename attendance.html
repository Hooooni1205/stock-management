<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>출퇴근 기록</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
            margin: 50px;
        }
        button {
            display: block;
            width: 80%;
            padding: 15px;
            margin: 10px auto;
            font-size: 18px;
            cursor: pointer;
        }
        #status {
            font-size: 20px;
            font-weight: bold;
            margin-bottom: 20px;
        }
    </style>
</head>
<body>
    <h2>🕒 출퇴근 기록</h2>
    <p id="status">로그인 확인 중...</p>
    <button id="clockInButton" onclick="recordAttendance('출근')">✅ 출근</button>
    <button id="clockOutButton" onclick="askBreak()">🚪 퇴근</button>

    <script>
        document.addEventListener("DOMContentLoaded", function () {
            const storedEmployeeId = localStorage.getItem("employeeId");
            const storedEmployeeName = localStorage.getItem("employeeName"); 
        
            if (storedEmployeeId && storedEmployeeName) {
                console.log("✅ 로그인된 사용자:", storedEmployeeName);
                showAttendanceUI(storedEmployeeName); // 출퇴근 UI 표시
            } else {
                console.log("🚨 로그인 정보 없음 - 로그인 필요");
                document.getElementById("loginNotice").style.display = "block"; // 로그인 필요 메시지 표시
            }
        });
        
        function showAttendanceUI(employeeName) {
            document.getElementById("loginNotice").style.display = "none"; // 로그인 메시지 숨김
            document.getElementById("attendanceUI").style.display = "block"; // 출퇴근 UI 표시
            document.getElementById("employeeName").innerText = employeeName; // 직원 이름 표시
        }
        const employeeId = localStorage.getItem("employeeId");

        if (!employeeId) {
            document.getElementById("status").innerText = "로그인이 필요합니다.";
            document.getElementById("clockInButton").style.display = "none";
            document.getElementById("clockOutButton").style.display = "none";
        } else {
            document.getElementById("status").innerText = "출퇴근 기록을 선택하세요.";
        }

        function recordAttendance(type, restUse = "-") {
            google.script.run.recordAttendance(employeeId, type, restUse);
            alert(`${type}이 기록되었습니다.`);
            window.location.href = "index.html"; // ✅ 기록 후 메인 화면으로 이동
        }

        function askBreak() {
            let restUse = confirm("휴게시간을 사용하셨나요? (확인: O, 취소: X)");
            restUse = restUse ? "휴게사용O" : "휴게사용X";
            recordAttendance("퇴근", restUse);
        }
    </script>
</body>
</html>
